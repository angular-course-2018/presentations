<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>reveal.js</title>

	<link rel="stylesheet" href="../../revealjs/css/reveal.css">
	<link rel="stylesheet" href="../../revealjs/css/theme/night.css">

	<!-- Theme used for syntax highlighting of code -->
	<link rel="stylesheet" href="../../revealjs/lib/css/zenburn.css">

	<!-- Printing and PDF exports -->
	<script>
		var link = document.createElement('link');
		link.rel = 'stylesheet';
		link.type = 'text/css';
		link.href = window.location.search.match(/print-pdf/gi) ? '../../../revealjs/css/print/pdf.css' : '../../revealjs/css/print/paper.css';
		document.getElementsByTagName('head')[0].appendChild(link);
	</script>
	<style>
		body {
			background-image: url(../../assets/angular-logo.svg);
			background-repeat: no-repeat;
			background-size: 50% auto;
			background-position: -25% -60%;
		}

		.reset-img {
			border: 0 !important;
			background: none !important;
			box-shadow: none !important;
		}

		.red-border {
			border: 5px solid red !important;
			position: absolute;
			left: 45px;

		}

		.red-border-reducer-1 {
			width: 350px;
			height: 146px;
			top: 114px;

		}

		.red-border-reducer-2 {
			width: 350px;
			height: 22px;
			top: 300px;
		}

		.red-border-reducer-3 {
			width: 829px;
			height: 154px;
			top: 380px;
		}

		.red-border-action-1 {
			width: 655px;
			height: 106px;
			top: 143px;
		}

		.red-border-action-2 {
			width: 655px;
			height: 221px;
			top: 269px;
		}

		.red-border-selector-1 {
			width: 775px;
			height: 82px;
			top: 143px;
		}

		.red-border-selector-2 {
			width: 775px;
			height: 239px;
			top: 244px;
		}

		.red-border-effect-1 {
			width: 580px;
			height: 50px;
			top: 221px;
		}

		.red-border-effect-2 {
			width: 580px;
			height: 22px;
			top: 352px;
		}

		.red-border-effect-3 {
			width: 928px;
			height: 205px;
			top: 403px;
		}
	</style>
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section>
				<h5>
					<img class="reset-img" height="600" src="../../assets/the-one.png" />
					<!-- One <span style="text-decoration: line-through">ring</span> state to rule them all! -->
				</h5>
			</section>
			<section>
				<p>
					Ash nazg durbatul√ªk, ash nazg gimbatul,
					<br />
					Ash nazg thrakatul√ªk agh burzum-ishi krimpatul.
				</p>
				<p class="fragment">
					One ring to rule them all, one ring to find them,
					<br />
					One ring to bring them all and in the darkness bind them.
				</p>
			</section>
			<section>
				<h4>One ring</h4>
				<h4 class="fragment">to rule them all</h4>
			</section>
			<section>
				<h5>A single state</h5>
				<h5 class="fragment">to rule the app</h5>
			</section>
			<section>
				<h5>A single source of truth</h5>
				<blockquote>...is the practice of structuring information models and associated data schema such that every data
					element is stored exactly <b>once</b>...</blockquote>
			</section>
			<!-- <section>
				<h5>not source, but state</h5>
				<div style="background: url('../../assets/application-state-flow.png') no-repeat; background-size:contain; width:700px; height:500px; margin:0 auto;"></div>
			</section> -->
			<section data-transition="slide-in none-out">
				<img class="reset-img" src="../../assets/mvvm-no-store.png" style="margin:0" />
			</section>
			<section data-transition="none-in slide-out">
					<img class="reset-img" src="../../assets/mvvm-vs-store.png" style="margin:0" />
			</section>
			<section>
				<h4>State should...</h4>
				<ul style="list-style: none;">
					<li>üöµ‚Äç‚ôÄÔ∏è be single</li>
					<li>üèÑ‚Äç be immutable</li>
					<li>üö™ be changed via single entrypoint</li>
				</ul>
			</section>
			<section>
				<h4>REDUX</h4>
				<img src="../../assets/react_redux.png" class="reset-img" />
			</section>
			<section>
				<h5>Dispatching an Action</h5>
				<img class="reset-img" src="../../assets/action.png" />
			</section>
			<section>
				<h5>Reducer</h5>
				<img src="../../assets/reducers.png" class="reset-img" />
			</section>
			<section data-transition="slide-in none-out">
				<h5>Reducer in Action</h5>
				<img class="reset-img" src="../../assets/state-action-0.png" />
			</section>
			<section data-transition="none-in none-out">
				<h5>Reducer in Action</h5>
				<img class="reset-img" src="../../assets/state-action-1.png" />
			</section>
			<section data-transition="none-in none-out">
				<h5>Reducer in Action</h5>
				<img class="reset-img" src="../../assets/state-action-2.png" />
			</section>
			<section data-transition="none-in slide-out">
				<h5>Reducer in Action</h5>
				<img class="reset-img" src="../../assets/state-action-3.png" />
			</section>
			<section>
				<h4><img class="reset-img" src="../../assets/ngrx.svg" style="height:80px; vertical-align: middle; margin-right: 10px ;" />Introducing
					NgRx</h4>
				<img class="reset-img" src="../../assets/ngrx-architexture-minimal.png" />
			</section>
			<section>
				Real apps DO need side effects!
			</section>
			<section>
				<h4><img class="reset-img" src="../../assets/ngrx.svg" style="height:80px; vertical-align: middle; margin-right: 10px ;" />Introducing
					NgRx</h4>
				<img class="reset-img" src="../../assets/ngrx-architexture.png" />
			</section>
			<section>
				<h4>NgRx parts</h4>
				<ul style="list-style: none">
					<li>Actions</li>
					<li>Reducers</li>
					<li>Selectors</li>
					<li>Effects</li>
				</ul>
			</section>
			<section>
				<h4>Actions</h4>
				<pre>
					<code>
export enum BoardActionTypes {
  PICK_CARD = '[BOARD] pick card',
  SET_CARDS = '[BOARD] set cards',
}
	
export class PickCard implements Action {
  readonly type = BoardActionTypes.PICK_CARD;
  constructor(public payload: Card) { }
}
export class SetCards implements Action {
  readonly type = BoardActionTypes.SET_CARDS;
  constructor(public payload: Card[]) { }
}
							  

					</code>
				</pre>
				<div class="fragment red-border red-border-action-1"></div>
				<div class="fragment red-border red-border-action-2"></div>
			</section>
			<section>
				<h4>Reducers</h4>
				<pre>
					<code  style="min-height:450px" class="language-typescript" data-trim>
export class BoardState {
  cards: Card[];
  selectedCard?: Card;
  match: Match;
}

export function boardReducer(
  state = new BoardState(),
  action: BoardActions.BoardActions
): BoardState {
  switch (action.type) {
    case BoardActions.SET_CARDS:
      return { ...state, cards: [...action.payload] };
    default:
      return state;
  }
}
					</code>
				</pre>
				<div class="fragment red-border red-border-reducer-1"></div>
				<div class="fragment red-border red-border-reducer-2"></div>
				<div class="fragment red-border red-border-reducer-3"></div>
			</section>
			<section>
				<h4>Selectors</h4>
				<pre>
					<code>
@Injectable()
export class BoardSelectors {
  constructor(private store: Store&lt;AppState>) { }

  get cards$() {
    return this.store.select(state => state.board.cards);
  }

  cardById$(id: number) {
	return this.store.select(store => 
	  store.board.cards.find(card => card.id === id));
  }
}
					</code>
				</pre>
				<div class="fragment red-border red-border-selector-1"></div>
				<div class="fragment red-border red-border-selector-2"></div>
			</section>
			<section>
				<h4>Effects</h4>
				<pre>
					<code style="width:960px; max-height:860px">
@Injectable()
export class BoardEffects {
  constructor(
    private actions$: Actions,
    private boardSelectors: BoardSelectors,
  ) { }

  @Effect() startGame$ = this.actions$
    .ofType(BoardActionTypes.START_GAME)
    .pipe(
      switchMap((action) => {
        return interval(1000).pipe(
        takeUntil(this.actions$.ofType(BoardActionTypes.GAME_ENDED)),
        withLatestFrom(this.boardSelectors.time$),
        switchMap(([tick, currentTime]) => {
          return [new BoardActions.SetTime(currentTime + 1000)];
        })
      );
    })
);
					</code>
				</pre>
				<div class="fragment red-border red-border-effect-1"></div>
				<div class="fragment red-border red-border-effect-2"></div>
				<div class="fragment red-border red-border-effect-3"></div>

			</section>
			<section>
				<h4>Wiring it all up!</h4>
				<pre style="margin-bottom:0;">
					<code class="language-typescript" data-trim>
// in feature						
imports: [
  CommonModule,
  EffectsModule.forFeature([BoardEffects]),
  StoreModule.forFeature('board', boardReducer),
],						
					</code>
				</pre>
				<pre style="margin-top:0;">
					<code class="language-typescript" data-trim>
// in app						
imports: [
  BoardModule,
  EffectsModule.forRoot([]),
  StoreModule.forRoot({}),
  StoreDevtoolsModule.instrument({
    maxAge: 25, 
    logOnly: environment.production,
  }),
],
					</code>
				</pre>
			</section>
			<section>
				<h4>Notable NgRx Reactive operators</h4>
				<ul style="list-style: none;">
					<li><code>map</code></li>
					<li><code>switchMap</code></li>
					<li><code>withLatestFrom</code></li>
					<li><code>delay</code></li>

				</ul>
			</section>
			<section>
				<h4>NgRx Best Practices</h4>
				<ul>
					<li>Logic writtent in services, accessed from effects</li>
					<li>Feature separation</li>
					<li>NgRx is reactive, use it</li>
				</ul>
			</section>
			<section>
				<h3>Action Time</h3>
				<img class="reset-img" src="../../assets/bungee.png" />
			</section>
			<section>
				<ul style="list-style: none; font-size: 30px">
					<li><u>board.reducers.ts</u></li>
					<ul style="margin-bottom:20px">
						<li>Implement the board.reducers file (SET_CARDS, SET_IS_DISABLED actions)</li>
					</ul>
					<li><u>app.module.ts, board.module.ts</u></li>
					<ul style="margin-bottom:20px">
						<li>wire the BoardState, BoardEffects to the module and the to the app</li>
					</ul>
					<li><u>board.effects.ts</u></li>
					<ul style="margin-bottom:20px">
						<li>Implemenet startNewGame$ effect by pulling cards from server into the store</li>
						<li>Implemenet resetCards$ effect to have all cards reset their properties</li>
					</ul>
					<li><u>board.selectors.ts</u></li>
					<ul>
						<li>Implement cards$ and selectedCards$ selectors</li>
					</ul>
				</ul>
				<ul style="font-size: 26px; list-style: none; border:3px dashed aqua; padding:10px;">
					<li>starter branch: <b>ngrx-starter</b></li>
					<li>solution branch: <b>ngrx-solution</b></li>
				</ul>
			</section>
		</div>
	</div>

	<script src="../../revealjs/lib/js/head.min.js"></script>
	<script src="../../revealjs/js/reveal.js"></script>

	<script>
		// More info about config & dependencies:
		// - https://github.com/hakimel/reveal.js#configuration
		// - https://github.com/hakimel/reveal.js#dependencies
		Reveal.initialize({
			history: true,
			dependencies: [
				{ src: '../../revealjs/plugin/markdown/marked.js' },
				{ src: '../../revealjs/plugin/markdown/markdown.js' },
				{ src: '../../revealjs/plugin/notes/notes.js', async: true },
				{ src: '../../revealjs/plugin/highlight/highlight.js', async: true, callback: function () { hljs.initHighlightingOnLoad(); } }
			]
		});
	</script>

</body>

</html>